# 🌀 Wrangler Configuration for Core Tessie API Worker
name = "core-tessie-api"
main = "src/main.py"
compatibility_date = "2024-05-12"
compatibility_flags = ["python_workers"]
workers_dev = true

# 🔐 Secrets
# Define via: wrangler secret put TESSIE_API_KEY
#             wrangler secret put JWT_SECRET

[build]
# This command tells pip to install your project and its dependencies
# from pyproject.toml before bundling.
command = "pip install -e ."

# 🧠 Workers AI Binding
# Gives the Worker direct access to Cloudflare’s AI inference platform.
[ai]
binding = "AI"

# 💾 KV Namespace
[[kv_namespaces]]
binding = "KV"
id = "eee506db5bfd4d87bfcb5fd947accc04"

# 🗄️ D1 Database
[[d1_databases]]
binding = "DB"
database_name = "core-tessie-api"
database_id = "a8b120ac-9449-470a-b3e6-3730dc651542"
migrations_dir = "migrations"

# 📬 Queue
[[queues.producers]]
binding = "QUEUE"
queue = "core-tessie-api"

# ☁️ R2 Bucket
[[r2_buckets]]
binding = "BUCKET"
bucket_name = "core-tessie-api"

# 📊 Analytics Engine Dataset
[[analytics_engine_datasets]]
binding = "ANALYTICS_ENGINE"
dataset = "core-tessie-api"

# 🤖 AI Reasoning Model
[vars]
# Default reasoning model used by AI agents / orchestrators
DEFAULT_MODEL_REASONING = "@cf/openai/gpt-oss-120b"
# Interval (in hours) between automated D1 syncs
SYNC_INTERVAL_HOURS = "4"

# 🕓 CRON trigger to automatically log Tessie API responses to D1
# Runs every 4 hours (00, 04, 08, 12, 16, 20 UTC)
[[triggers.crons]]
schedule = "0 */4 * * *"


[scripts]
# build = "python build.py"
deploy = "python deploy.py"
